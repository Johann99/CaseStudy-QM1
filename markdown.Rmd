---
title: 'Fallstudie: Robinson Club'
author: "Piet"
date: "15 2 2020"
output: html_document
---


# Zielformulierung: Ist die Einführung von Bionahrung beim Robinson Club aus betriebswirtschaftlicher Sicht strategisch sinvoll?

## Fragestellungen:

(1) Welchen Einfluss hat das Essen auf das Wohlbefinden der G ̈aste? (Stellen- wert des Essens im Vergleich zu den sonstigen Angeboten ROBINSONs)
(2) IsteinAngebotvonBionahrungdenG ̈astenwichtig/erwu ̈nscht/erwartet? (Wichtigkeit von Bionahrung)
(3) Was bedeutet Bio fu ̈r die G ̈aste? (Herausstellen der Elemente von Bion- ahrung und der Wichtigkeit dieser Elemente)
(4) Sind die G ̈aste bereit fu ̈r ein Angebot von Bionahrung einen Aufschlag zu zahlen? (Preissensitivit ̈at der G ̈aste fu ̈r ein zus ̈atzliches Angebot von Bionahrung)
(5) Wem genau ist das Angebot von Bionahrung wichtig? Wie unterscheiden sich diese Personen? (Zielgruppenidentifikation bezu ̈glich Bionahrung)
(6) Bei welchen Lebensmittelarten ist das Angebot von Bio besonders wichtig /
unwichtig? (Wichtigkeit von Bio bei unterschiedlichen Lebensmittelarten)
(7) Welche Biosiegel sind den G ̈asten bekannt? (Bekanntheit Biosiegel)

## Hypothesen:

(1) Personen mit Kindern bevorzugen Bionahrung eher als Personen ohne Kinder. 
(2) Robinson G ̈aste sind bereit fu ̈r Bionahrung einen Aufschlag zu zahlen.
(3) Bionahrung besitzt das Potenzial ROBINSON als Marke zu st ̈arken.

## Packages importieren 

```{r}
install.packages('tidyverse')
library(tidyverse)

install.packages('dplyr')
library(dplyr)

install.packages('data.table')
library(data.table)

install.packages('VIM')
library(VIM)

install.packages('class')
library(class)

install.packages("factoextra")
library(factoextra)

```


## Daten importieren und schnellen Überblick verschaffen


```{r}
fragebogen = read.csv('fallstudie.csv')

sum(is.na(fragebogen))

str(fragebogen)

head(fragebogen)
```

## CLEANING 

### Umgang mit fehlenden Werten

#### Drei verschiedene Arten von fehlenden Daten 

1. Missing completely at random (MCAR):
  Das Fehlen der Daten steht in keiner Beziehung zu den anderen Daten. Wenn man vorhersagen 
  kann, welche Daten fehlen, dann kann man MCAR ausschließen. Das fehlen der Daten ist somit
  komplett zufällig.

2. Missing at random (MAR): 
  Die Idee hinter dieser Art von fehlenden Daten ist, dass wir die fehlenden Daten 
  vorhersagen können anhand des Datensets. 

3. Missing not at random (nonignorable)
  In diesem Fall können wir keine Aussage oder Prognose für die fehlenden Werte machen. Es 
  ist weder MAR noch MCAR. 


#### Drei verschiedene Methoden mit fehlenden Daten umzugehen:

1.FEHLENDE DATEN LÖSCHEN  
  Wenn NA's nur wenige (max 0,5 %) von Erhebung macht droppen Sinn, da einfach und 
  Testergebnis nicht zu sehr verzerrt wird. na.omit() wäre der Code-Snippet. Dabei würde 
  wenn überhaupt eine reihenweise Löschung Sinn machen, da wir für die Analyse eines 
  Befragten die ganzen Werte brauchen. Dies führt allerdings zur Löschung 
  des komplette Datensets. Somit kommt diese Methode für uns nicht in Frage.
  
2.FEHLENDEN DATEN MIT TEST STATISTIKEN FÜLLEN
  Wenn mean() dann darf der prozentuale Anteil von NA's auch nicht so hoch sein (kann man 
  hier einfach den Default Alpha Value nehmen?)
  Es verringert die Varianz der Erhebungsdaten, da diese geglättet werden durch das 
  arithemtische Mittel.
  Extreme Ausreißer können den mean() zu stark beeinflussen und das Ergebniss verzerren. 
  Hier sind die Zahlen       
  kategorisch vorgegeben, somit kann es keine größeren Ausreißer geben. 
  
3.FEHLENDE DATEN MIT MACHINE LEARNING ALGORITHMEN BESTIMMEN
  Ein Beispiel für ein einfach zu implementierenden Algorithmus wäre K-Means oder auch KNN 
  genannt.
  Idee hinter KNN: Die fehlenden Werte können mit den Werte die diesem Wert in einem 
  zweidimensionalen Koordinatensystem am nähesten Liegen ermittelt werden. 
  Kann sehr viel genauer sein als ein einfache means() und es ist sehr sensitiv was 
  Outliers anbelangt. Allerdings
  für uns könnten diese Methodik sehr interessant sein, da wir keine Ausreißer im 
  klassischen Sinne haben können, da
  die Range schon vorgegeben ist. Dieser Algorithmus kann für stetig und diskrete Daten 
  genutzt werden.
  


## Welche Spalten sind von NA's betroffen?

```{r}

contains_any_na = sapply(fragebogen, function(x) any(is.na(x)))
column_names_na = names(fragebogen)[contains_any_na]

## df das anzeigt wie viel Prozent NA pro Spalte vorhanden sind
perc_na = sapply(fragebogen, function(x) sum(is.na(x))/count(fragebogen))
perc_na = as.data.frame(perc_na)
perc_na


```

## Welche Spalten (Fragen) können wir ausschließen? 
Dabei können wir aus dem Fragebogen schon erkennen, das die Fragen 7,14,24 Text als Antwort haben. Des Weiteren sehen wir in der
Datenstruktur, dass diese Fragen als Factor spezifiziert sind. Wir müssen alle Spalten exkludieren, welche auf 'txt' oder auf 'txt_val' enden. Diese Spalten müssen seperat betrachtet werden.  

```{r}

#drop von den Text Daten

fragebogendt<-as.data.table(fragebogen)
fragebogenneu<-fragebogendt[,grep("txt",colnames(fragebogendt))]
fragebogenneu
numericfragebogen<-fragebogen[-fragebogenneu]


num1 = numericfragebogen[-129]
num2<-num1[-1:-2]
num3<-num2[-127]
num4<-num3[-122]
num5<-num4[-100]

# drop von denen dessen Normierung nicht 1-7 ist
num6 <- num5
num6$f1 <- NULL
num6 <- select(num5, -(f20:f26))
num6 <- select(num6, -(f11_2:f13_3))
num6$f2 <- NULL
num6 <- select(num6, -(f8:f11_1))

# NEUER NAME: df mit ausschließlich ordinalen Skalierung mit der gleichen Normierung von 1-7
sc_1_7_fragebogen = num6



```

## KNN Imputation


```{r}
# skalierung von 1-7 in einem df sc_1_7_fragebogen als knn_fragebogen gespeichert um fehlende Werte durch KNN zu ermitteln (Imputation)
# k=sqrt(count(fragebogen)

knn_fragebogen = kNN(sc_1_7_fragebogen,k=sqrt(count(fragebogen)))

# zusätzlichen Spalten, die durch den algo knn erstellt wurden, droppen 
knn_fragebogen = select(knn_fragebogen, -(f3_1_imp:f19_10_imp))
knn_fragebogen = select(knn_fragebogen, -(f1_imp))

# double check ob auch wirklich alle NA's imputiert wurden
sum(is.na(knn_fragebogen))

# test ob Imputation statistisch erfolgreich

# Zum visuellen Vergleich wie gut KNN Algo funkt hat
plot(fragebogen$f4_11)
plot(essen_wohlbefinden)

essen_wohlbefinden = knn_fragebogen$f4_11




```

## Frage 1: Welchen Einfluss hat das Essen auf das Wohlbefinden der Gäste? (Stellen- wert des Essens im Vergleich zu den sonstigen Angeboten ROBINSON
```{r}
KOMMENTAR
#Prozentualer Anteil an Probanden, die Essen als Wichtig erachten 

barplot(table(essen_wohlbefinden) , main = "Wichtigkeit des Essens",xlab = "Wichtigkeit", ylab = "Anzahl der befragten Gäste", space = 1, cex.axis = 1, cex.names = 1, cex.lab = 1, cex.main = 1.5)

# Essen ist den befragten Gästen sehr wichitg
MW4.1 <- mean(knn_fragebogen$f4_1)
MW4.2 <- mean(knn_fragebogen$f4_2)
MW4.3 <- mean(knn_fragebogen$f4_3)
MW4.4 <- mean(knn_fragebogen$f4_4)
MW4.5 <- mean(knn_fragebogen$f4_5)
MW4.6 <- mean(knn_fragebogen$f4_6)
MW4.7 <- mean(knn_fragebogen$f4_7)
MW4.8 <- mean(knn_fragebogen$f4_8)
MW4.9 <- mean(knn_fragebogen$f4_9)
MW4.10 <- mean(knn_fragebogen$f4_10)
MW4.11<- mean(knn_fragebogen$f4_11)
MW4.12<- mean(knn_fragebogen$f4_12)
MW4.13 <- mean(knn_fragebogen$f4_13)
MW4.14 <- mean(knn_fragebogen$f4_14)

MWVektorEssen <- c(MW4.1,MW4.2,MW4.3,MW4.4,MW4.5,MW4.6,MW4.7,MW4.8,MW4.9,MW4.10,MW4.11,MW4.12,MW4.13,MW4.14)
barplot(MWVektorEssen, main = "Vergleich der Angebote",xlab = "Angebote", ylab = "Wichtigkeit", space = 1, cex.axis = 1, cex.names = 1, cex.lab = 1, cex.main = 1.5)
```

**Angebot 11 (Essen) ist den befragten Gästen am wichtigsten im Vergleich zu dem restlichen Angebot**


## Frage 2: Ist ein Angebot von Bionahrung den Gästen wichtig/erwünscht/erwartet? (Wichtigkeit von Bionahrung)
```{r}
essen_bionahrung = knn_fragebogen$f4_13
barplot(table(essen_bionahrung), main = "Wichtigkeit von Bionahrung",xlab = "Wichtigkeit", ylab = "Anzahl der befragten Gäste", space = 1, cex.axis = 1, cex.names = 1, cex.lab = 1, cex.main = 1.5)
```


**Bionahrung ist den Gästen wichtig**


##F Frage 3: Was bedeutet Bio fu ̈r die G ̈aste? (Herausstellen der Elemente von Bion- ahrung und der Wichtigkeit dieser Elemente) 




## Frage 4: Sind die G ̈aste bereit fu ̈r ein Angebot von Bionahrung einen Aufschlag zu zahlen? (Preissensitivit ̈at der G ̈aste fu ̈r ein zus ̈atzliches Angebot von Bionahrung)

```{r}
price_sensitivity = numericfragebogen$f17 
price_sensitivity = as.data.table(price_sensitivity)
price_sensitivity = na.omit(price_sensitivity)


#Wie viele n's vor dem droppen von NA Reihen? --> 219
length(numericfragebogen$f17)

#Wie viele n's? --> 100 
count(price_sensitivity)

#Wie viele würden überhaupt mehr bezahlen? --> 66 Personen 
ps_0 = price_sensitivity[price_sensitivity>0, .N]

#Wie viele würden mehr als 3 % bezahlen? --> 47 Personen
ps_3 = price_sensitivity[price_sensitivity>3, .N]
u_ps_3 = ps_3 * 0.03 


#Wie viele würden mehr als 5 % bezahlen? --> 26 Personen
ps_5 = price_sensitivity[price_sensitivity>5, .N]
u_ps_5 = ps_5 * 0.05

#Wie viele würden mehr als 10 % bezahlen? --> 7 Personen
ps_10 = price_sensitivity[price_sensitivity>10, .N]
u_ps_10 = ps_10 * 0.1

#Wie viele würden mehr als 15 % bezahlen? --> 5 Personen
ps_15 = price_sensitivity[price_sensitivity>15, .N]
u_ps_15 = ps_15 * 0.15

#Wie viele würden mehr als 20 % bezahlen? --> 2 Personen 
ps_20 = price_sensitivity[price_sensitivity>20, .N]
u_ps_20 = ps_20 * 0.2

#Ergebnisse in einen Vektor packen
all_ps = c(ps_3, ps_5, ps_10, ps_15, ps_20)
all_u_ps = c(u_ps_3,u_ps_5,u_ps_10,u_ps_15,u_ps_20)

#barplot in absoluten Zahlen
barplot(all_ps)
#barplot in Prozenten, wir müssen davon ausgehen, dass diejenigen die nicht geantwortet haben, keinen Aufschlag zahlen würden
barplot(all_ps/length(numericfragebogen$f17))

#barplot Umsatz für jede Erhöhung --> Zeigt welche Prozenterhöhung sich lohnen würde wenn man die prozentuale Erhöhung und die Kaufbereitschaft der Kunden betrachtet
barplot(all_u_ps)







```

# Frage 5: Wem genau ist das Angebot von Bionahrung wichtig? Wie unterscheiden sich diese Personen? (Zielgruppenidentifikation bezüglich Bionahrung)

```{r}

# Annahme: Ab 3 oder kleiner ist Bio für die Probanden wichtig 
#data.table(knn_fragebogen)
#bio = knn_fragebogen$f4_13
#bio_wichtig = bio[bio<=3]
#bio_wichtig = as.data.table(bio_wichtig)


# Leute die Bio mögen und und Demografische Daten
bio2 = numericfragebogen[numericfragebogen$f4_13<3,]
bio2 = select(bio2, -c(f3_1:f6_9))
bio2 = select(bio2, -c(f15_1:f19_10))
bio2 = select(bio2, -c(f8:f13_3))
#nicht brauchbar 
bio2 = select(bio2, -c(ID:Ort))
bio2 = select(bio2, -c(f23_4))
#niemand hat das alter seines/ihres 4. Kindes angegeben
bio2 = select(bio2, -c(f24))




# das richtige K finden mit Elbow Method 



```



## Frage 6: Bei welchen Lebensmittelarten ist das Angebot von Bio besonders wichtig /unwichtig? (Wichtigkeit von Bio bei unterschiedlichen Lebensmittelarten)
```{r}
MW16.1 <- mean(knn_fragebogen$f16_1)
MW16.2 <- mean(knn_fragebogen$f16_2)
MW16.3 <- mean(knn_fragebogen$f16_3)
MW16.4 <- mean(knn_fragebogen$f16_4)
MW16.5 <- mean(knn_fragebogen$f16_5)
MW16.6 <- mean(knn_fragebogen$f16_6)
MW16.7 <- mean(knn_fragebogen$f16_7)
MW16.8 <- mean(knn_fragebogen$f16_8)
MW16.9 <- mean(knn_fragebogen$f16_9)

MWVektorBionahrung <- c(MW16.1,MW16.2,MW16.3,MW16.4,MW16.5,MW16.6,MW16.7,MW16.8,MW16.9)


barplot(MWVektorBionahrung, main = "Wichtigkeit von Bio bei unterschiedlichen Lebensmittelarten",xlab = "Lebensmittelkategorien", ylab = "Wichtigkeit", space = 1, cex.axis = 1, cex.names = 1, cex.lab = 1, cex.main = 1)
```

**Bei Gemüse & Salat (2), Obst (3) und Fleischprodukten (5) ist Bio für die Gäste wichtig. Bei Süßigkeiten (7), Gewürzen (8) und bei den Getränken (9) eher nicht.**








